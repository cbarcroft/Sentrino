jQuery ->
	$.get $('#task_form').data('new-url'), (data) ->
		$('#task_form').html(data)
	$.get $('#task_index').data('new-url'), (data) ->
		$('#task_index').html(data)

  $('form').on 'click', '.remove_fields', (event) ->
    $(this).prev('input[type=hidden]').val('1')
    $(this).closest('fieldset').hide()
    event.preventDefault()

  $('form').on 'click', '.add_fields', (event) ->
    time = new Date().getTime()
    regexp = new RegExp($(this).data('id'), 'g')
    $(this).before($(this).data('fields').replace(regexp, time))
    event.preventDefault()

  $('#task_list').on 'click', '.task-list-item', (event) ->
    renderTaskForm $(this).data("id")

  $('#new_task').submit ->
  	$.post(
  		$(this).attr('action')
  		$(this).serialize()
  		(data, textStatus, jqXHR) ->
  			renderTaskList()
  	)
  	return false

renderTaskForm = (taskId = false) ->
	url = if taskId then $('#task_form').data('edit-url').replace '?', taskId else $('#task_form').data('new-url')
	$.get url, (data) ->
		$('#task_form').html(data)

renderTaskList = ->
	$.get $('#task_index').data('new-url'), (data) ->
		$('#task_index').html(data)